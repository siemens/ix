import{b as w}from"./chunk-FEKEKWUS.js";import{a as H,c as y,d as E,e as P,f as _}from"./chunk-L7URYGIT.js";import"./chunk-NWJ5J3BN.js";function I(h,n,e){let t=document.createElement("ix-tree-item");return t.hasChildren=h.hasChildren,t.context=n,t.text=h.data.name,e(i=>{t.text=i.data.name}),t}var v={force:!1};var u=h=>!Number.isNaN(Number(h)),S=(h,n)=>{h.classList.add(n)},T=(()=>{class h{static create(e,t=h.defaultConfig){return new h(e,t)}static mergeStyle(e,t){for(let i in t)e.style[i]!==t[i]&&(e.style[i]=t[i])}static getMaxBrowserHeight(){let e=document.createElement("div"),t=document.createElement("div");h.mergeStyle(e,{position:"absolute",height:"1px",opacity:0}),h.mergeStyle(t,{height:"1e7px"}),e.appendChild(t),document.body.appendChild(e);let i=t.offsetHeight;return document.body.removeChild(e),i}constructor(e,t){this._scrollListener=null,this._pendingRender=!1,this._lastRepaint=null,this._maxElementHeight=h.getMaxBrowserHeight(),this.refresh(e,t);let i=this._config,o=()=>{this._pendingRender=!1;let l=this._getScrollPosition(),a=this._lastRepaint;if(l===a)return;let r=a?l-a:0;if(!a||r<0||r>this._averageHeight){let c=this._renderChunk();this._lastRepaint=l,c!==!1&&typeof i.afterRender=="function"&&i.afterRender()}},s=i.scrollContainer||e;this._scrollListener=()=>{this._pendingRender||(this._pendingRender=!0,this._renderAnimationFrame=window.requestAnimationFrame(o))},s.addEventListener("scroll",this._scrollListener,{passive:!0}),o()}destroy(){this._renderAnimationFrame&&window.cancelAnimationFrame(this._renderAnimationFrame);let e=this._config,t=e?.scrollContainer||this._element;this._scrollListener&&t&&t.removeEventListener("scroll",this._scrollListener)}refresh(e,t=h.defaultConfig){var i;let o=((i=this._config)===null||i===void 0?void 0:i.scrollContainer)||this._element;if(this._scrollListener&&o&&o.removeEventListener("scroll",this._scrollListener),this._config=t,!e||e.nodeType!==1)throw new Error("HyperList requires a valid DOM Node container");this._element=e;let s=this._config,l=this._scroller||s.scroller||document.createElement(s.scrollerTagName||"tr");if(typeof s.useFragment!="boolean"&&(this._config.useFragment=!0),!s.generate)throw new Error("Missing required `generate` function");if(!u(s.total))throw new Error("Invalid required `total` value, expected number");if(!Array.isArray(s.itemHeight)&&!u(s.itemHeight))throw new Error("\n        Invalid required `itemHeight` value, expected number or array\n      ".trim());u(s.itemHeight)?this._itemHeights=Array(s.total).fill(s.itemHeight):this._itemHeights=[s.itemHeight],Object.keys(h.defaultConfig).filter(m=>m in s).forEach(m=>{let f=s[m],x=u(f);if(f&&typeof f!="string"&&typeof f!="number"){let C=`Invalid optional \`${m}\`, expected string or number`;throw new Error(C)}else x&&(s[m]=`${f}px`)});let a=!!s.horizontal,r=s[a?"width":"height"];if(r){let m=u(r),f=m?!1:r.slice(-1)==="%",x=parseInt(m?r:r.replace(/px|%/,""),10),C=window[a?"innerWidth":"innerHeight"];f?this._containerSize=C*x/100:this._containerSize=u(r)?r:x}let c=s.scrollContainer,d=s.itemHeight*s.total,g=this._maxElementHeight;d>g&&console.warn(["HyperList: The maximum element height",g+"px has","been exceeded; please reduce your item height."].join(" "));let p={width:`${s.width}`,height:c?`${d}px`:`${s.height}`,overflow:c?"none":"auto",position:"relative"};h.mergeStyle(e,p),c&&h.mergeStyle(s.scrollContainer,{overflow:"auto"});let L={opacity:"0",position:"absolute",[a?"height":"width"]:"1px",[a?"width":"height"]:`${d}px`};h.mergeStyle(l,L),this._scroller||e.appendChild(l);let b=this._computeScrollPadding();this._scrollPaddingBottom=b.bottom,this._scrollPaddingTop=b.top,this._scroller=l,this._scrollHeight=this._computeScrollHeight(),this._itemPositions=this._itemPositions||Array(s.total).fill(0),this._computePositions(0),this._renderChunk(this._lastRepaint!==null),typeof s.afterRender=="function"&&s.afterRender(),this._scrollListener&&(s.scrollContainer||e).addEventListener("scroll",this._scrollListener,{passive:!0})}_getRow(e){let t=this._config,i=t.generate(e),o=i.height;if(o!==void 0&&u(o)?(i=i.element,o!==this._itemHeights[e]&&(this._itemHeights[e]=o,this._computePositions(e),this._scrollHeight=this._computeScrollHeight())):o=this._itemHeights[e],!i||i.nodeType!==1)throw new Error(`Generator did not return a DOM Node for index: ${e}`);S(i,t.rowClassName||"vrow");let s=this._itemPositions[e]+this._scrollPaddingTop;return h.mergeStyle(i,{position:"absolute",[t.horizontal?"left":"top"]:`${s}px`}),i}_getScrollPosition(){let e=this._config;return typeof e.overrideScrollPosition=="function"?e.overrideScrollPosition():this._element[e.horizontal?"scrollLeft":"scrollTop"]}_renderChunk(e=!1){let t=this._config,i=this._element,o=this._getScrollPosition(),s=t.total,l=this._getFrom(o)-1;if((l<0||l-this._screenItemsLen<0)&&(l=0),!e&&this._lastFrom===l)return!1;this._lastFrom=l;let a=l+this._cachedItemsLen;(a>s||a+this._cachedItemsLen>s)&&(a=s);let r=t.useFragment?document.createDocumentFragment():[],c=this._scroller;r[t.useFragment?"appendChild":"push"](c);for(let d=l;d<a;d++){let g=this._getRow(d);r[t.useFragment?"appendChild":"push"](g)}if(t.applyPatch)return t.applyPatch(i,r);i.innerHTML="",i.appendChild(r)}_computePositions(e=1){let i=this._config.total;e<1&&(e=1);for(let o=e;o<i;o++)this._itemPositions[o]=this._itemHeights[o-1]+this._itemPositions[o-1]}_computeScrollHeight(){let e=this._config,t=!!e.horizontal,i=e.total,o=this._itemHeights.reduce((g,p)=>g+p,0)+this._scrollPaddingBottom+this._scrollPaddingTop;h.mergeStyle(this._scroller,{opacity:0,position:"absolute",top:"0px",[t?"height":"width"]:"1px",[t?"width":"height"]:`${o}px`});let s=this._itemHeights.slice(0).sort((g,p)=>g-p),l=Math.floor(i/2),a=i%2===0?(s[l]+s[l-1])/2:s[l],r=t?"clientWidth":"clientHeight",c=e.scrollContainer?e.scrollContainer:this._element,d=c[r]?c[r]:this._containerSize;return this._screenItemsLen=Math.ceil(d/a),this._containerSize=d,this._cachedItemsLen=Math.max(this._cachedItemsLen||0,this._screenItemsLen*3),this._averageHeight=a,o}_computeScrollPadding(){let t=!!this._config.horizontal,i=window.getComputedStyle(this._element),o=s=>{let l=i.getPropertyValue(`padding-${s}`);return parseInt(l,10)||0};return t?{bottom:o("right"),top:o("left")}:{bottom:o("bottom"),top:o("top")}}_getFrom(e){let t=0;for(;this._itemPositions[t]<e;)t++;return t}}return h.defaultConfig={width:"100%",height:"100%"},h})(),R=":host{display:block}",N=(()=>{let h=class{constructor(n){H(this,n),this.contextChange=_(this,"contextChange",7),this.nodeToggled=_(this,"nodeToggled",7),this.nodeClicked=_(this,"nodeClicked",7),this.nodeRemoved=_(this,"nodeRemoved",7),this.root="root",this.model={},this.context={},this.updates=new Map,this.hasFirstRender=!1,this.dirtyItems=new Set}updatePadding(n,e){n.style.paddingLeft=e.level+"rem"}getVirtualizerOptions(n){let e=this.buildTreeList(this.model[this.root]);return{width:"100%",height:"100%",itemHeight:32,total:e.length,generate:t=>{let i=e[t],o=this.hostElement.querySelector(`[data-tree-node-id="${i.id}"]`),s=this.getContext(i.id);if(o&&n.force===!1){o.hasChildren=i.hasChildren,o.context=Object.assign({},s);let c=this.dirtyItems.has(i.id);if(this.updates.has(i.id)){let d=this.updates.get(i.id);if(d){let g=d(i,Object.assign({},this.context));typeof g=="boolean"&&(c=g)}}if(this.updatePadding(o,i),!c)return o}let l=c=>{this.updates.set(i.id,c)},a=null;this.renderItem&&(a=this.renderItem(t,i,e,Object.assign({},this.context),l)),a===null&&(a=I(i,s,l));let r=a;return r.setAttribute("data-tree-node-id",i.id),r.style.paddingRight="1rem",this.updatePadding(r,i),this.dirtyItems.delete(i.id),r}}}setContext(n,e){this.context=Object.assign(Object.assign({},this.context),{[n]:e}),this.contextChange.emit(this.context)}getContext(n){return this.context?(this.context[n]||(this.context[n]={isExpanded:!1,isSelected:!1}),this.context[n]):{isExpanded:!1,isSelected:!1}}buildTreeList(n,e=0){let t=[];if(n?.hasChildren){let i=e+1;n.children.forEach(o=>{let s=this.model[o],l=this.getContext(o);t.push(Object.assign(Object.assign({},s),{level:e})),s.hasChildren&&l.isExpanded&&t.push(...this.buildTreeList(s,i))})}return t}componentDidLoad(){this.initList(),this.observer=new MutationObserver(n=>{let e=[];n.forEach(t=>{e=[...e,...Array.from(t.removedNodes)],t.addedNodes.forEach(i=>{let o=e.indexOf(i);o>=0&&e.splice(o,1)})}),this.nodeRemoved.emit(e)}),this.observer.observe(this.hostElement,{childList:!0})}componentWillRender(){this.hasFirstRender=!0,this.isListInitialized()?this.refreshTree():this.initList()}connectedCallback(){this.hasFirstRender&&this.initList()}disconnectedCallback(){var n,e;(n=this.hyperlist)===null||n===void 0||n.destroy(),(e=this.observer)===null||e===void 0||e.disconnect()}onModelChange(){this.hasFirstRender&&!this.isListInitialized()&&this.initList()}async markItemsAsDirty(n){n.forEach(e=>this.dirtyItems.add(e))}isListInitialized(){var n;let e=(n=this.hyperlist)===null||n===void 0?void 0:n._itemPositions;return e!==void 0&&e.length&&!e?.some(t=>t===void 0||Number.isNaN(t))}async refreshTree(n=v){this.hyperlist&&this.hyperlist.refresh(this.hostElement,this.getVirtualizerOptions(n))}initList(){var n;if(!this.model)return;(n=this.hyperlist)===null||n===void 0||n.destroy();let e=this.getVirtualizerOptions(v);this.hyperlist=new T(this.hostElement,e)}onToggle(n){let{target:e}=n;if(n.preventDefault(),n.stopPropagation(),!(e instanceof HTMLElement))return;let t=e.getAttribute("data-tree-node-id");if(!t||!this.model[t].hasChildren)return;let o=this.getContext(t);o.isExpanded=!o.isExpanded,this.nodeToggled.emit({id:t,isExpanded:o.isExpanded}),this.setContext(t,o)}onTreeItemClick(n){let{target:e}=n;if(!(e instanceof HTMLElement))return;let t=e.getAttribute("data-tree-node-id");if(!t)return;let i=this.model[t],o=n.composedPath(),s=o.indexOf(this.hostElement),l=o.slice(0,s);if(!w.pathIncludesTrigger(l)){if(!n.defaultPrevented){Object.values(this.context).forEach(c=>c.isSelected=!1);let r=this.getContext(t);r.isSelected=!0,this.setContext(t,r)}if(this.toggleOnItemClick&&i.hasChildren){let r=this.getContext(t);r.isExpanded=!r.isExpanded,this.nodeToggled.emit({id:t,isExpanded:r.isExpanded}),this.setContext(t,r)}this.nodeClicked.emit(t)}}render(){return y(E,{key:"d144ff5b676bdcafc424afea72834ea712c95dff",onClick:n=>this.onTreeItemClick(n)},y("slot",{key:"fc2f5555f95788c57fa66b150cc844024bc6677a"}))}get hostElement(){return P(this)}static get watchers(){return{model:["onModelChange"]}}};return h.style=R,h})();export{N as ix_tree};
