import{b as k}from"./chunk-VD56CH4Q.js";import{a as w,b as f,c as v,d as b,g as y,h as E}from"./chunk-DT6OGIJY.js";import{a as x}from"./chunk-C65ZGZNU.js";import{a as c}from"./chunk-PYELUUTO.js";import{a as l,b as o}from"./chunk-FEKEKWUS.js";import{a as d}from"./chunk-BBI5W3XS.js";import{a as g}from"./chunk-355ZUK6P.js";import{a as C,c as r,d as u,e as S,f as D}from"./chunk-I5VBTOIN.js";import"./chunk-NWJ5J3BN.js";var A=":host{background-color:var(--theme-color-2);border-radius:var(--theme-default-border-radius);min-width:0px;z-index:var(--theme-z-index-dropdown);box-shadow:var(--theme-shadow-4);padding:0.25rem 0px}:host *,:host *::after,:host *::before{box-sizing:border-box}:host ::-webkit-scrollbar-button{display:none}@-moz-document url-prefix(){:host *{scrollbar-color:var(--theme-scrollbar-thumb--background) var(--theme-scrollbar-track--background);scrollbar-width:thin}}:host{}:host ::-webkit-scrollbar{width:0.5rem;height:0.5rem}:host{}:host ::-webkit-scrollbar-track{border-radius:5px;background:var(--theme-scrollbar-track--background)}:host ::-webkit-scrollbar-track:hover{background:var(--theme-scrollbar-track--background--hover)}:host{}:host ::-webkit-scrollbar-thumb{border-radius:5px;background:var(--theme-scrollbar-thumb--background)}:host{}:host ::-webkit-scrollbar-thumb:hover{background:var(--theme-scrollbar-thumb--background--hover)}:host ::-webkit-scrollbar-corner{display:none}:host .dropdown-header{display:flex;align-items:center;height:2.5rem;color:var(--theme-menu-header--color);padding:0 1rem}:host(.overflow){max-height:calc(50vh - 3rem);overflow-y:auto}:host(:not(.show)){display:none}.dialog{margin:0;border:none;outline:none;padding:0.25rem 0px;min-width:0;max-width:100vw;width:-moz-max-content;width:max-content;height:-moz-fit-content;height:fit-content;background-color:var(--theme-color-2);border-radius:var(--theme-default-border-radius);box-shadow:var(--theme-shadow-4);overflow-x:visible;overflow-y:visible;inset:unset;color-scheme:inherit;color:var(--theme-color-std-text);box-sizing:border-box}.dialog *,.dialog *::after,.dialog *::before{box-sizing:border-box}.dialog .dropdown-container{display:block;position:relative}.dialog .dropdown-header{display:flex;align-items:center;height:2.5rem;color:var(--theme-menu-header--color);padding:0 1rem}.dialog.overflow{max-height:calc(50vh - 3rem);overflow-y:auto}",L=0,B=(()=>{let m=class{constructor(e){C(this,e),this.showChanged=D(this,"showChanged",7),this.suppressAutomaticPlacement=!1,this.show=!1,this.closeBehavior="both",this.placement="bottom-start",this.positioningStrategy="fixed",this.discoverAllSubmenus=!1,this.ignoreRelatedSubmenu=!1,this.suppressOverflowBehavior=!1,this.enableTopLayer=!1,this.dialogRef=g(),this.localUId=`dropdown-${L++}`,this.assignedSubmenu=[],this.itemObserver=new MutationObserver(()=>{this.arrowFocusController&&(this.arrowFocusController.items=this.dropdownItems)})}connectedCallback(){o.connected(this),this.trigger!=null&&this.registerListener(this.trigger)}cacheSubmenuId(e){e.stopImmediatePropagation(),e.preventDefault();let{detail:t}=e;this.assignedSubmenu.indexOf(t)===-1&&this.assignedSubmenu.push(t)}disconnectedCallback(){var e;o.dismiss(this),o.disconnected(this),this.arrowFocusController&&((e=this.arrowFocusController)===null||e===void 0||e.disconnect(),this.arrowFocusController=void 0),this.itemObserver&&(this.itemObserver.disconnect(),this.itemObserver=void 0),this.disposeClickListener&&(this.disposeClickListener(),this.disposeClickListener=void 0),this.disposeKeyListener&&(this.disposeKeyListener(),this.disposeKeyListener=void 0),this.autoUpdateCleanup&&(this.autoUpdateCleanup(),this.autoUpdateCleanup=void 0)}getAssignedSubmenuIds(){return this.assignedSubmenu}isPresent(){return this.show}present(){this.show=!0}dismiss(){this.show=!1}getId(){return this.localUId}willDismiss(){let{defaultPrevented:e}=this.showChanged.emit(!1);return!e}willPresent(){let{defaultPrevented:e}=this.showChanged.emit(!0);return!e}get dropdownItems(){return Array.from(this.hostElement.querySelectorAll("ix-dropdown-item"))}get slotElement(){return this.hostElement.shadowRoot.querySelector("slot")}addEventListenersFor(){var e,t,i;(e=this.disposeClickListener)===null||e===void 0||e.call(this),(t=this.disposeKeyListener)===null||t===void 0||t.call(this);let s=()=>{this.isPresent()?o.dismiss(this):o.present(this),o.dismissOthers(this.getId())};this.triggerElement&&(this.disposeClickListener=d(this.triggerElement,"click",n=>{n.defaultPrevented||s()}),(i=this.triggerElement)===null||i===void 0||i.setAttribute("data-ix-dropdown-trigger",this.localUId))}async discoverSubmenu(){var e;(e=this.triggerElement)===null||e===void 0||e.dispatchEvent(new CustomEvent("ix-assign-sub-menu",{bubbles:!0,composed:!0,cancelable:!0,detail:this.localUId}))}registerKeyListener(){this.triggerElement&&(this.disposeKeyListener=d(this.triggerElement,"keydown",e=>{e.key==="ArrowDown"&&document.activeElement===this.triggerElement&&(o.present(this),setTimeout(()=>{this.focusDropdownItem(0)}))}))}async registerListener(e){this.triggerElement=await this.resolveElement(e),this.triggerElement&&(this.addEventListenersFor(),this.discoverSubmenu())}async resolveElement(e){let t=await k(e);return this.checkForSubmenuAnchor(t)}async checkForSubmenuAnchor(e){if(e){if(l(e)){let t=await e.getDropdownItemElement();t.isSubMenu=!0,this.hostElement.style.zIndex="var(--theme-z-index-dropdown)"}return e.tagName==="IX-DROPDOWN-ITEM"&&(e.isSubMenu=!0,this.hostElement.style.zIndex="var(--theme-z-index-dropdown)"),e}}async resolveAnchorElement(){this.anchor?this.anchorElement=await this.resolveElement(this.anchor):this.trigger&&(this.anchorElement=await this.resolveElement(this.trigger))}async changedShow(e){var t;if(!e){this.cleanupOnHide(),this.enableTopLayer&&await this.hideDropdownAsync();return}if(this.arrowFocusController=new x(this.dropdownItems,this.hostElement,i=>this.focusDropdownItem(i)),(t=this.itemObserver)===null||t===void 0||t.observe(this.hostElement,{childList:!0,subtree:!0}),this.registerKeyListener(),this.enableTopLayer){await this.showDropdownAsync();return}await this.resolveAnchorElement(),this.anchorElement&&this.applyDropdownPosition()}changedTrigger(e){this.registerListener(e)}destroyAutoUpdate(){this.autoUpdateCleanup&&(this.autoUpdateCleanup(),this.autoUpdateCleanup=void 0)}isAnchorSubmenu(){var e;return l(this.anchorElement)?!0:!!(!((e=this.anchorElement)===null||e===void 0)&&e.closest("ix-dropdown-item"))}async showDropdownAsync(){let e=await this.dialogRef.waitForCurrent();e&&(e.showPopover(),await this.resolveAnchorElement(),this.anchorElement?this.applyDropdownPosition():c(()=>{let i=(this.hostElement.parentElement||this.hostElement).getBoundingClientRect(),s=`translate(${Math.round(i.left)}px, ${Math.round(i.top)}px)`;Object.assign(e.style,{top:"0",left:"0",transform:s})}))}async hideDropdownAsync(){let e=await this.dialogRef.waitForCurrent();e?.matches(":popover-open")&&e.hidePopover()}cleanupOnHide(){var e,t,i;this.destroyAutoUpdate(),(e=this.arrowFocusController)===null||e===void 0||e.disconnect(),(t=this.itemObserver)===null||t===void 0||t.disconnect(),(i=this.disposeKeyListener)===null||i===void 0||i.call(this)}async applyDropdownPosition(){var e,t;if(!this.show||!this.anchorElement)return;let i=this.anchorElement,s=this.isAnchorSubmenu(),n=this.hostElement,p=this.positioningStrategy;if(this.enableTopLayer){let h=await this.dialogRef.waitForCurrent();if(!h)return;n=h,p="fixed"}let a={strategy:p,middleware:[]};this.suppressAutomaticPlacement||(e=a.middleware)===null||e===void 0||e.push(b({fallbackStrategy:"initialPlacement"})),a.placement=s?"right-start":this.placement,a.middleware=[...((t=a.middleware)===null||t===void 0?void 0:t.filter(Boolean))||[],y(),v()],this.offset&&a.middleware.push(f(this.offset)),this.destroyAutoUpdate(),this.autoUpdateCleanup=w(i,n,async()=>{let h=await E(i,n,a);if(Object.assign(n.style,{top:"0",left:"0",transform:`translate(${Math.round(h.x)}px,${Math.round(h.y)}px)`}),this.overwriteDropdownStyle){let I=await this.overwriteDropdownStyle({dropdownRef:n,triggerRef:this.triggerElement});Object.assign(n.style,I)}},{ancestorResize:!0,ancestorScroll:!0,elementResize:!0})}focusDropdownItem(e){c(()=>{var t,i;let s=(i=(t=this.dropdownItems[e])===null||t===void 0?void 0:t.shadowRoot)===null||i===void 0?void 0:i.querySelector("button");s&&s.focus()})}async componentDidLoad(){this.show&&this.changedShow(!0),this.trigger&&this.changedTrigger(this.trigger)}async componentDidRender(){await this.applyDropdownPosition(),await this.resolveAnchorElement()}isTriggerElement(e){return!!e.hasAttribute("data-ix-dropdown-trigger")}onDropdownClick(e){let t=o.pathIncludesTrigger(e.composedPath());if(t&&(t!==this.triggerElement&&e.preventDefault(),this.isTriggerElement(t))){this.closeBehavior==="outside"&&e.preventDefault();return}if(!e.defaultPrevented&&(this.closeBehavior==="inside"||this.closeBehavior==="both")){o.dismissAll([this.getId()],this.ignoreRelatedSubmenu);return}o.dismissOthers(this.getId())}async updatePosition(){this.applyDropdownPosition()}render(){return this.enableTopLayer?r(u,{"data-ix-dropdown":this.localUId,class:{"dropdown-menu":!0,show:this.show}},r("dialog",{ref:this.dialogRef,class:{dialog:!0,overflow:!this.suppressOverflowBehavior},popover:"manual","aria-modal":"true","aria-label":this.header,tabindex:-1,onClick:e=>this.onDropdownClick(e)},r("div",{class:"dropdown-container"},this.header&&r("div",{class:"dropdown-header"},this.header),this.show&&r("slot",null)))):r(u,{"data-ix-dropdown":this.localUId,class:{"dropdown-menu":!0,show:this.show,overflow:!this.suppressOverflowBehavior},style:{margin:"0",minWidth:"0px",position:this.positioningStrategy},role:"list",onClick:e=>this.onDropdownClick(e)},r("div",{style:{display:"contents"}},this.header&&r("div",{class:"dropdown-header"},this.header),this.show&&r("slot",null)))}get hostElement(){return S(this)}static get watchers(){return{show:["changedShow"],trigger:["changedTrigger"]}}};return m.style=A,m})();export{B as ix_dropdown};
