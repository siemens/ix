import{a as H,b as v}from"./chunk-73SGZEOQ.js";import{b as E}from"./chunk-FEKEKWUS.js";import{a as P,c as b,d as L,e as S,f as _}from"./chunk-TA677NDK.js";import{h as y}from"./chunk-B4AJQJMI.js";var u=c=>!Number.isNaN(Number(c)),T=(c,o)=>{c.classList.add(o)},R=(()=>{class c{static create(e,t=c.defaultConfig){return new c(e,t)}static mergeStyle(e,t){for(let i in t)e.style[i]!==t[i]&&(e.style[i]=t[i])}static getMaxBrowserHeight(){let e=document.createElement("div"),t=document.createElement("div");c.mergeStyle(e,{position:"absolute",height:"1px",opacity:0}),c.mergeStyle(t,{height:"1e7px"}),e.appendChild(t),document.body.appendChild(e);let i=t.offsetHeight;return document.body.removeChild(e),i}constructor(e,t){this._scrollListener=null,this._pendingRender=!1,this._lastRepaint=null,this._maxElementHeight=c.getMaxBrowserHeight(),this.refresh(e,t);let i=this._config,n=()=>{this._pendingRender=!1;let l=this._getScrollPosition(),h=this._lastRepaint;if(l===h)return;let r=h?l-h:0;if(!h||r<0||r>this._averageHeight){let a=this._renderChunk();this._lastRepaint=l,a!==!1&&typeof i.afterRender=="function"&&i.afterRender()}},s=i.scrollContainer||e;this._scrollListener=()=>{this._pendingRender||(this._pendingRender=!0,this._renderAnimationFrame=window.requestAnimationFrame(n))},s.addEventListener("scroll",this._scrollListener,{passive:!0}),n()}destroy(){this._renderAnimationFrame&&window.cancelAnimationFrame(this._renderAnimationFrame);let e=this._config,t=e?.scrollContainer||this._element;this._scrollListener&&t&&t.removeEventListener("scroll",this._scrollListener)}refresh(e,t=c.defaultConfig){var i;let n=((i=this._config)===null||i===void 0?void 0:i.scrollContainer)||this._element;if(this._scrollListener&&n&&n.removeEventListener("scroll",this._scrollListener),this._config=t,!e||e.nodeType!==1)throw new Error("HyperList requires a valid DOM Node container");this._element=e;let s=this._config,l=this._scroller||s.scroller||document.createElement(s.scrollerTagName||"tr");if(typeof s.useFragment!="boolean"&&(this._config.useFragment=!0),!s.generate)throw new Error("Missing required `generate` function");if(!u(s.total))throw new Error("Invalid required `total` value, expected number");if(!Array.isArray(s.itemHeight)&&!u(s.itemHeight))throw new Error("\n        Invalid required `itemHeight` value, expected number or array\n      ".trim());u(s.itemHeight)?this._itemHeights=Array(s.total).fill(s.itemHeight):this._itemHeights=[s.itemHeight],Object.keys(c.defaultConfig).filter(m=>m in s).forEach(m=>{let f=s[m],x=u(f);if(f&&typeof f!="string"&&typeof f!="number"){let C=`Invalid optional \`${m}\`, expected string or number`;throw new Error(C)}else x&&(s[m]=`${f}px`)});let h=!!s.horizontal,r=s[h?"width":"height"];if(r){let m=u(r),f=m?!1:r.slice(-1)==="%",x=parseInt(m?r:r.replace(/px|%/,""),10),C=window[h?"innerWidth":"innerHeight"];f?this._containerSize=C*x/100:this._containerSize=u(r)?r:x}let a=s.scrollContainer,d=s.itemHeight*s.total,g=this._maxElementHeight;d>g&&console.warn(["HyperList: The maximum element height",g+"px has","been exceeded; please reduce your item height."].join(" "));let p={width:`${s.width}`,height:a?`${d}px`:`${s.height}`,overflow:a?"none":"auto",position:"relative"};c.mergeStyle(e,p),a&&c.mergeStyle(s.scrollContainer,{overflow:"auto"});let I={opacity:"0",position:"absolute",[h?"height":"width"]:"1px",[h?"width":"height"]:`${d}px`};c.mergeStyle(l,I),this._scroller||e.appendChild(l);let w=this._computeScrollPadding();this._scrollPaddingBottom=w.bottom,this._scrollPaddingTop=w.top,this._scroller=l,this._scrollHeight=this._computeScrollHeight(),this._itemPositions=this._itemPositions||Array(s.total).fill(0),this._computePositions(0),this._renderChunk(this._lastRepaint!==null),typeof s.afterRender=="function"&&s.afterRender(),this._scrollListener&&(s.scrollContainer||e).addEventListener("scroll",this._scrollListener,{passive:!0})}_getRow(e){let t=this._config,i=t.generate(e),n=i.height;if(n!==void 0&&u(n)?(i=i.element,n!==this._itemHeights[e]&&(this._itemHeights[e]=n,this._computePositions(e),this._scrollHeight=this._computeScrollHeight())):n=this._itemHeights[e],!i||i.nodeType!==1)throw new Error(`Generator did not return a DOM Node for index: ${e}`);T(i,t.rowClassName||"vrow");let s=this._itemPositions[e]+this._scrollPaddingTop;return c.mergeStyle(i,{position:"absolute",[t.horizontal?"left":"top"]:`${s}px`}),i}_getScrollPosition(){let e=this._config;return typeof e.overrideScrollPosition=="function"?e.overrideScrollPosition():this._element[e.horizontal?"scrollLeft":"scrollTop"]}_renderChunk(e=!1){let t=this._config,i=this._element,n=this._getScrollPosition(),s=t.total,l=this._getFrom(n)-1;if((l<0||l-this._screenItemsLen<0)&&(l=0),!e&&this._lastFrom===l)return!1;this._lastFrom=l;let h=l+this._cachedItemsLen;(h>s||h+this._cachedItemsLen>s)&&(h=s);let r=t.useFragment?document.createDocumentFragment():[],a=this._scroller;r[t.useFragment?"appendChild":"push"](a);for(let d=l;d<h;d++){let g=this._getRow(d);r[t.useFragment?"appendChild":"push"](g)}if(t.applyPatch)return t.applyPatch(i,r);i.innerHTML="",i.appendChild(r)}_computePositions(e=1){let i=this._config.total;e<1&&(e=1);for(let n=e;n<i;n++)this._itemPositions[n]=this._itemHeights[n-1]+this._itemPositions[n-1]}_computeScrollHeight(){let e=this._config,t=!!e.horizontal,i=e.total,n=this._itemHeights.reduce((g,p)=>g+p,0)+this._scrollPaddingBottom+this._scrollPaddingTop;c.mergeStyle(this._scroller,{opacity:0,position:"absolute",top:"0px",[t?"height":"width"]:"1px",[t?"width":"height"]:`${n}px`});let s=this._itemHeights.slice(0).sort((g,p)=>g-p),l=Math.floor(i/2),h=i%2===0?(s[l]+s[l-1])/2:s[l],r=t?"clientWidth":"clientHeight",a=e.scrollContainer?e.scrollContainer:this._element,d=a[r]?a[r]:this._containerSize;return this._screenItemsLen=Math.ceil(d/h),this._containerSize=d,this._cachedItemsLen=Math.max(this._cachedItemsLen||0,this._screenItemsLen*3),this._averageHeight=h,n}_computeScrollPadding(){let t=!!this._config.horizontal,i=window.getComputedStyle(this._element),n=s=>{let l=i.getPropertyValue(`padding-${s}`);return parseInt(l,10)||0};return t?{bottom:n("right"),top:n("left")}:{bottom:n("bottom"),top:n("top")}}_getFrom(e){let t=0;for(;this._itemPositions[t]<e;)t++;return t}}return c.defaultConfig={width:"100%",height:"100%"},c})(),z=":host{display:block}",N=(()=>{let c=class{constructor(o){P(this,o),this.contextChange=_(this,"contextChange",7),this.nodeToggled=_(this,"nodeToggled",7),this.nodeClicked=_(this,"nodeClicked",7),this.nodeRemoved=_(this,"nodeRemoved",7),this.root="root",this.model={},this.context={},this.updates=new Map,this.hasFirstRender=!1,this.dirtyItems=new Set}updatePadding(o,e){o.style.paddingLeft=e.level+"rem"}getVirtualizerOptions(o){let e=this.buildTreeList(this.model[this.root]);return{width:"100%",height:"100%",itemHeight:32,total:e.length,generate:t=>{let i=e[t],n=this.hostElement.querySelector(`[data-tree-node-id="${i.id}"]`),s=this.getContext(i.id);if(n&&o.force===!1){n.hasChildren=i.hasChildren,n.context=Object.assign({},s);let a=this.dirtyItems.has(i.id);if(this.updates.has(i.id)){let d=this.updates.get(i.id);if(d){let g=d(i,Object.assign({},this.context));typeof g=="boolean"&&(a=g)}}if(this.updatePadding(n,i),!a)return n}let l=a=>{this.updates.set(i.id,a)},h=null;this.renderItem&&(h=this.renderItem(t,i,e,Object.assign({},this.context),l)),h===null&&(h=H(i,s,l));let r=h;return r.setAttribute("data-tree-node-id",i.id),r.style.paddingRight="1rem",this.updatePadding(r,i),this.dirtyItems.delete(i.id),r}}}setContext(o,e){this.context=Object.assign(Object.assign({},this.context),{[o]:e}),this.contextChange.emit(this.context)}getContext(o){return this.context?(this.context[o]||(this.context[o]={isExpanded:!1,isSelected:!1}),this.context[o]):{isExpanded:!1,isSelected:!1}}buildTreeList(o,e=0){let t=[];if(o?.hasChildren){let i=e+1;o.children.forEach(n=>{let s=this.model[n],l=this.getContext(n);t.push(Object.assign(Object.assign({},s),{level:e})),s.hasChildren&&l.isExpanded&&t.push(...this.buildTreeList(s,i))})}return t}componentDidLoad(){this.initList(),this.observer=new MutationObserver(o=>{let e=[];o.forEach(t=>{e=[...e,...Array.from(t.removedNodes)],t.addedNodes.forEach(i=>{let n=e.indexOf(i);n>=0&&e.splice(n,1)})}),this.nodeRemoved.emit(e)}),this.observer.observe(this.hostElement,{childList:!0})}componentWillRender(){this.hasFirstRender=!0,this.isListInitialized()?this.refreshTree():this.initList()}connectedCallback(){this.hasFirstRender&&this.initList()}disconnectedCallback(){var o,e;(o=this.hyperlist)===null||o===void 0||o.destroy(),(e=this.observer)===null||e===void 0||e.disconnect()}onModelChange(){this.hasFirstRender&&!this.isListInitialized()&&this.initList()}markItemsAsDirty(o){return y(this,null,function*(){o.forEach(e=>this.dirtyItems.add(e))})}isListInitialized(){var o;let e=(o=this.hyperlist)===null||o===void 0?void 0:o._itemPositions;return e!==void 0&&e.length&&!e?.some(t=>t===void 0||Number.isNaN(t))}refreshTree(){return y(this,arguments,function*(o=v){this.hyperlist&&this.hyperlist.refresh(this.hostElement,this.getVirtualizerOptions(o))})}initList(){var o;if(!this.model)return;(o=this.hyperlist)===null||o===void 0||o.destroy();let e=this.getVirtualizerOptions(v);this.hyperlist=new R(this.hostElement,e)}onToggle(o){let{target:e}=o;if(o.preventDefault(),o.stopPropagation(),!(e instanceof HTMLElement))return;let t=e.getAttribute("data-tree-node-id");if(!t||!this.model[t].hasChildren)return;let n=this.getContext(t);n.isExpanded=!n.isExpanded,this.nodeToggled.emit({id:t,isExpanded:n.isExpanded}),this.setContext(t,n)}onTreeItemClick(o){let{target:e}=o;if(!(e instanceof HTMLElement))return;let t=e.getAttribute("data-tree-node-id");if(!t)return;let i=this.model[t],n=o.composedPath(),s=n.indexOf(this.hostElement),l=n.slice(0,s);if(!E.pathIncludesTrigger(l)){if(!o.defaultPrevented){Object.values(this.context).forEach(a=>a.isSelected=!1);let r=this.getContext(t);r.isSelected=!0,this.setContext(t,r)}if(this.toggleOnItemClick&&i.hasChildren){let r=this.getContext(t);r.isExpanded=!r.isExpanded,this.nodeToggled.emit({id:t,isExpanded:r.isExpanded}),this.setContext(t,r)}this.nodeClicked.emit(t)}}render(){return b(L,{key:"d144ff5b676bdcafc424afea72834ea712c95dff",onClick:o=>this.onTreeItemClick(o)},b("slot",{key:"fc2f5555f95788c57fa66b150cc844024bc6677a"}))}get hostElement(){return S(this)}static get watchers(){return{model:["onModelChange"]}}};return c.style=z,c})();export{N as ix_tree};
