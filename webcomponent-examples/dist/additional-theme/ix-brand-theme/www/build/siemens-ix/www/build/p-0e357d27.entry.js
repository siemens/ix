import{r as t,c as i,h as e,H as s,g as o}from"./p-05c16b94.js";import{a as r}from"./p-c8cc3bb3.js";import{L as c,I as a}from"./p-0a12b3df.js";const h=class{constructor(e){t(this,e),this.inputChanged=i(this,"inputChanged",7),this.filterChanged=i(this,"filterChanged",7),this.ID_CUSTOM_FILTER_VALUE="CW_CUSTOM_FILTER_VALUE",this.documentClickCallback=this.handleDocumentClick.bind(this),this.hasFocus=void 0,this.showCategorySelection=void 0,this.categoryLogicalOperator=c.EQUAL,this.inputValue=void 0,this.category=void 0,this.filterTokens=[],this.offsetDropdownX=void 0,this.offsetDropdownY=void 0,this.maxHeightDropdown=void 0,this.maxWidthDropdown=void 0,this.initialState=void 0,this.filterState=void 0,this.placeholder=void 0,this.categories=void 0,this.nonSelectableCategories={},this.suggestions=void 0,this.icon="search",this.hideIcon=void 0,this.repeatCategories=!0,this.tmpDisableScrollIntoView=!0,this.labelCategories="Categories",this.i18nPlainText="Filter by text"}watchFilterState(t){this.setFilterState(t)}watchShowCategorySelection(t){t?document.addEventListener("click",this.documentClickCallback):document.removeEventListener("click",this.documentClickCallback)}setDropdownOffset(){const t=this.calculateDropdownHeight();this.maxHeightDropdown=r(t)}componentDidLoad(){var t,i;void 0!==this.initialState?this.setFilterState(this.initialState):void 0!==this.filterState&&this.setFilterState(this.filterState),null===(t=this.hostElement)||void 0===t||t.addEventListener("keydown",this.handleFormElementKeyDown.bind(this)),null===(i=this.formElement)||void 0===i||i.addEventListener("submit",(t=>t.preventDefault())),null!=this.textInput?(this.textInput.addEventListener("click",(()=>this.showCategorySelection=!0)),this.textInput.addEventListener("focusin",(()=>{this.hasFocus=!0})),this.textInput.addEventListener("focusout",(()=>this.hasFocus=!1)),this.textInput.addEventListener("input",(()=>{this.inputValue=this.textInput.value;const t=new a(this.inputValue,this.category);this.inputChanged.emit(t),this.showCategorySelection=!0})),this.textInput.addEventListener("keydown",this.handleInputElementKeyDown.bind(this))):console.warn("Core UI category filter - unable to add event listeners to native input element")}setFilterState(t){this.filterTokens=[];for(const i of t.tokens)this.addToken(i,this.ID_CUSTOM_FILTER_VALUE,this.categoryLogicalOperator,!1);for(const i of t.categories)this.addToken(i.value,i.id,i.operator,!1);this.emitFilterEvent()}handleDocumentClick(t){this.hostElement.contains(t.target)||this.closeDropdown()}closeDropdown(){this.showCategorySelection=!1,this.category=void 0}handleFormElementKeyDown(t){switch(t.code){case"Enter":case"NumpadEnter":if(this.category||document.activeElement.classList.contains("plain-text-suggestion")){const t=document.activeElement.getAttribute("data-id");this.addToken(t,this.category)}else document.activeElement.classList.contains("category-item-id")&&this.selectCategory(document.activeElement.getAttribute("data-id"));t.preventDefault();break;case"ArrowUp":this.focusPreviousItem(),t.preventDefault();break;case"ArrowDown":this.focusNextItem(),t.preventDefault();break;case"Escape":this.closeDropdown()}}focusPreviousItem(){const t=document.activeElement.previousSibling;t instanceof HTMLElement&&t.focus()}focusNextItem(){const t=document.activeElement.nextSibling;t instanceof HTMLElement&&t.focus()}handleInputElementKeyDown(t){var i;switch(t.code){case"ArrowDown":let e=this.hostElement.querySelector(".category-item-"+(this.category?"value":"id"));e instanceof HTMLElement?(e.focus(),t.stopPropagation()):(null===(i=this.suggestions)||void 0===i?void 0:i.length)&&(e=this.hostElement.querySelector(".category-item"),e instanceof HTMLElement&&(e.focus(),t.stopPropagation()));break;case"Backspace":if(""!==this.textInput.value)return;if(this.category)return void(this.category=void 0);const s=this.filterTokens.length;s>0&&this.removeToken(s-1);break;case"Enter":case"NumpadEnter":this.addToken(this.inputValue,this.category),t.preventDefault()}}emitFilterEvent(){const t=this.filterTokens.filter((t=>t.id===this.ID_CUSTOM_FILTER_VALUE)).map((t=>t.value)),i=this.filterTokens.filter((t=>t.id!==this.ID_CUSTOM_FILTER_VALUE));this.filterChanged.emit({tokens:t,categories:i})}addToken(t,i=this.ID_CUSTOM_FILTER_VALUE,e=this.categoryLogicalOperator,s=!0){if(null==t)return;const o=t.trim();""!==o&&(this.filterTokens.find((t=>(null==t?void 0:t.value)===o))||(this.filterTokens=[...this.filterTokens,{id:i,value:o,operator:e}],this.textInput.value="",this.inputValue="",this.categoryLogicalOperator=c.EQUAL,this.isScrollStateDirty=!0,this.textInput.focus(),s&&this.emitFilterEvent(),this.closeDropdown()))}removeToken(t){this.filterTokens=this.filterTokens.filter(((i,e)=>e!==t)),this.emitFilterEvent()}getCategoryIds(){const t=[];for(const i in this.categories)Object.prototype.hasOwnProperty.call(this.categories,i)&&t.push(i);return t}getCategoryLables(){return this.getCategoryIds().map((t=>this.categories[t].label))}selectCategory(t){this.category=t,this.textInput.value="",this.inputValue="",this.textInput.focus()}openCategorySelection(){this.showCategorySelection=!0}resetFilter(){this.closeDropdown(),this.filterTokens=[],this.emitFilterEvent()}calculateDropdownX(){var t;return this.textInput?this.textInput.getBoundingClientRect().x-(null===(t=this.formElement)||void 0===t?void 0:t.getBoundingClientRect().x):0}calculateDropdownY(){return this.textInput?this.hostElement.getBoundingClientRect().height:32}calculateDropdownHeight(t=32){const i=this.hostElement.getBoundingClientRect().top;return window.innerHeight-(i+t)}filterMultiples(t){return!!this.repeatCategories||!this.filterTokens.find((i=>i.id===t))}filterDuplicateTokens(t){return!this.filterTokens.some((i=>i.value===t))}filterByInput(t){return void 0===this.inputValue||""===this.inputValue||-1!==t.toLowerCase().indexOf(this.inputValue.toLowerCase())}toggleCategoryOperator(){switch(this.categoryLogicalOperator){case c.EQUAL:this.categoryLogicalOperator=c.NOT_EQUAL;break;case c.NOT_EQUAL:this.categoryLogicalOperator=c.EQUAL}}getFilterChipLabel(t){var i,e,s;return t.id===this.ID_CUSTOM_FILTER_VALUE?t.value:`${null!==(s=null!==(e=null===(i=this.categories[t.id])||void 0===i?void 0:i.label)&&void 0!==e?e:this.nonSelectableCategories[t.id])&&void 0!==s?s:t.id} ${t.operator===c.EQUAL?"=":"!="} ${t.value}`}componentDidRender(){const t=this.calculateDropdownX(),i=this.calculateDropdownY(),e=r(t),s=r(i),o=this.hostElement.getBoundingClientRect().width-t,c=this.calculateDropdownHeight(i);this.maxWidthDropdown=r(o),this.maxHeightDropdown=r(c),e!==this.offsetDropdownX&&(this.offsetDropdownX=e),s!==this.offsetDropdownY&&(this.offsetDropdownY=s),this.isScrollStateDirty&&(this.tmpDisableScrollIntoView||this.textInput.scrollIntoView(),this.isScrollStateDirty=!1)}getResetButton(){return e("ix-icon-button",{onClick:()=>this.resetFilter(),class:{"reset-button":!0,"hide-reset-button":!this.filterTokens.length&&!this.category},variant:"Secondary",ghost:!0,oval:!0,icon:"clear",size:"16",tabindex:"1"})}render(){var t,i,o,r,a,h;return e(s,null,e("form",{ref:t=>this.formElement=t},e("div",{class:{"form-control":!0,"input-container":!0,focus:this.hasFocus,"no-icon":this.hideIcon}},e("ix-icon",{class:{"d-none":this.hideIcon},name:this.icon,size:"16"}),e("div",{class:"token-container"},e("ul",{class:"list-unstyled"},this.filterTokens.map(((t,i)=>e("li",{class:{animate__animated:!0,animate__fadein:!0}},e("ix-filter-chip",{onCloseClick:()=>this.removeToken(i)},this.getFilterChipLabel(t))))),void 0===this.categories?"":e("li",{class:{"category-preview":!0,"d-none":!this.category}},null===(t=this.categories[this.category])||void 0===t?void 0:t.label),e("input",{class:{"text-input":!0,"hide-placeholder":void 0!==this.category},ref:t=>this.textInput=t,type:"text",placeholder:this.placeholder,onFocus:()=>this.openCategorySelection()}))),this.getResetButton())),e("div",{class:{"category-selection-container":!0,"d-none":!this.showCategorySelection&&void 0===this.category},style:{left:this.offsetDropdownX,top:this.offsetDropdownY,"max-width":this.maxWidthDropdown,"max-height":this.maxHeightDropdown}},e("div",{class:{"d-none":!this.showCategorySelection||void 0!==this.category}},e("div",{class:{"category-item-header":!0,"d-none":0===this.getCategoryLables().filter((t=>this.filterByInput(t))).length}},this.labelCategories),null===(i=this.getCategoryIds())||void 0===i?void 0:i.filter((t=>this.filterByInput(this.categories[t].label))).filter((t=>this.filterMultiples(t))).map((t=>{var i;return e("div",{"data-id":t,title:t,class:"category-item category-item-id",onClick:()=>this.selectCategory(t),tabindex:"0"},null===(i=this.categories[t])||void 0===i?void 0:i.label)}))),e("div",{class:{"d-none":void 0===this.category}},e("button",{class:"btn btn-invisible-secondary btn-icon",onClick:()=>this.toggleCategoryOperator(),tabindex:"-1"},this.categoryLogicalOperator===c.NOT_EQUAL?"=":"!="),void 0===this.categories?"":e("div",{class:"category-item-header"},null===(o=this.categories[this.category])||void 0===o?void 0:o.label),void 0===this.categories?"":null===(r=this.categories[this.category])||void 0===r?void 0:r.options.filter((t=>this.filterByInput(t))).filter((t=>this.filterDuplicateTokens(t))).map((t=>e("div",{"data-id":t,title:t,class:"category-item category-item-value",onClick:()=>this.addToken(t,this.category),tabindex:"0"},`${this.categoryLogicalOperator===c.EQUAL?"=":"!="} ${t}`)))),e("div",{class:{"category-item-header":!0,"d-none":void 0!==this.category||this.getCategoryIds().filter((t=>this.filterByInput(t))).length>0}},this.i18nPlainText),e("div",{class:{"d-none":!(null===(a=this.suggestions)||void 0===a?void 0:a.length)||void 0!==this.category}},null===(h=this.suggestions)||void 0===h?void 0:h.filter((t=>this.filterByInput(t))).filter((t=>this.filterDuplicateTokens(t))).map((t=>e("div",{"data-id":t,class:"category-item plain-text-suggestion",onClick:()=>this.addToken(t),tabindex:"0"},t))))))}get hostElement(){return o(this)}static get watchers(){return{filterState:["watchFilterState"],showCategorySelection:["watchShowCategorySelection"]}}};h.style=".sc-ix-category-filter-h{display:block;position:relative}.sc-ix-category-filter-h .focus.sc-ix-category-filter{border-color:var(--theme-color-primary);box-shadow:0 0 0.25rem 0 var(--theme-color-primary) !important}.sc-ix-category-filter-h .reset-button.sc-ix-category-filter{position:absolute;top:0.25rem;right:0.25rem}.sc-ix-category-filter-h .reset-button.hide-reset-button.sc-ix-category-filter{display:none}.sc-ix-category-filter-h .input-container.sc-ix-category-filter{display:flex;height:100%;max-height:3.75rem;padding:1px 1.5rem 1px 2rem}.sc-ix-category-filter-h .input-container.no-icon.sc-ix-category-filter{padding-left:0.25rem}.sc-ix-category-filter-h .token-container.sc-ix-category-filter{flex-grow:1;overflow:hidden}.sc-ix-category-filter-h .text-input.sc-ix-category-filter{overflow:hidden;text-overflow:ellipsis;white-space:nowrap;-webkit-font-smoothing:antialiased;-moz-osx-font-smooting:grayscale;font-family:Siemens Sans, sans-serif;font-size:0.875rem;font-weight:400;line-height:1.429em;color:var(--theme-color-std-text);background:transparent;flex-grow:1;height:1.75rem}.sc-ix-category-filter-h .text-input.sc-ix-category-filter,.sc-ix-category-filter-h .text-input.sc-ix-category-filter:hover,.sc-ix-category-filter-h .text-input.sc-ix-category-filter:focus-visible{border:none;outline:none}.sc-ix-category-filter-h .text-input.hide-placeholder.sc-ix-category-filter::-moz-placeholder{opacity:0}.sc-ix-category-filter-h .text-input.hide-placeholder.sc-ix-category-filter::placeholder{opacity:0}.sc-ix-category-filter-h .list-unstyled.sc-ix-category-filter{display:flex;flex-wrap:wrap;list-style:none;padding:0;margin:0;overflow-y:auto}.sc-ix-category-filter-h ix-icon.sc-ix-category-filter{position:absolute;top:0.5rem;left:0.5rem}.sc-ix-category-filter-h ix-filter-chip.sc-ix-category-filter{margin-right:0.5rem}.sc-ix-category-filter-h .category-preview.sc-ix-category-filter{display:flex;align-items:center;height:1.5rem;background-color:var(--theme-bg-3);border-top-left-radius:1rem;border-bottom-left-radius:1rem;padding:0.5rem;margin:2px 0}.sc-ix-category-filter-h .category-selection-container.sc-ix-category-filter{box-shadow:var(--theme-box-shadow-level-1);background:var(--theme-color-1);position:absolute;top:2rem;overflow-y:auto;min-width:10rem;border:var(--theme-std-bdr-1);border-radius:0.25rem;padding:0.5rem;z-index:1}.sc-ix-category-filter-h .category-selection-container.sc-ix-category-filter .category-item.sc-ix-category-filter,.sc-ix-category-filter-h .category-selection-container.sc-ix-category-filter .category-item-header.sc-ix-category-filter{-webkit-font-smoothing:antialiased;-moz-osx-font-smooting:grayscale;font-family:Siemens Sans, sans-serif;font-size:0.875rem;font-weight:400;line-height:1.143em;color:var(--theme-color-std-text);overflow:hidden;text-overflow:ellipsis;white-space:nowrap;height:2rem;padding:0.5rem}.sc-ix-category-filter-h .category-selection-container.sc-ix-category-filter .category-item-header.sc-ix-category-filter{color:var(--theme-color-soft-text)}.sc-ix-category-filter-h .category-selection-container.sc-ix-category-filter .category-item-id.sc-ix-category-filter{border-top-left-radius:1rem;border-bottom-left-radius:1rem}.sc-ix-category-filter-h .category-selection-container.sc-ix-category-filter .category-item-value.sc-ix-category-filter{border-top-right-radius:1rem;border-bottom-right-radius:1rem}.sc-ix-category-filter-h .category-selection-container.sc-ix-category-filter .category-item.sc-ix-category-filter{cursor:pointer}.sc-ix-category-filter-h .category-selection-container.sc-ix-category-filter .category-item.sc-ix-category-filter:focus{background-color:var(--theme-generic-bg-active);outline:none}.sc-ix-category-filter-h .category-selection-container.sc-ix-category-filter .plain-text-suggestion.sc-ix-category-filter{border-radius:1rem}.sc-ix-category-filter-h ul.sc-ix-category-filter{height:100%}.sc-ix-category-filter-h ul.sc-ix-category-filter>li.sc-ix-category-filter,.sc-ix-category-filter-h input.sc-ix-category-filter{padding-top:2px;padding-bottom:2px}";export{h as ix_category_filter}