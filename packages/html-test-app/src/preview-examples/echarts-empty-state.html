<!--
SPDX-FileCopyrightText: 2024 Siemens AG

SPDX-License-Identifier: MIT

This source code is licensed under the MIT license found in the
LICENSE file in the root directory of this source tree.
-->

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ECharts example</title>
  <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.1/dist/echarts.min.js"></script>
</head>
<body class="theme-classic-dark">
<!-- Preview code -->
<div
  style="
        display: block;
        position: relative;
        width: 100%;
        height: 40rem;
        padding-top: 1rem;
      "
>
  <div id="empty-state-container" class="empty-state-container">
    <ix-empty-state
      class="empty-state"
      header="No elements available"
      sub-header="Failed to retrieve data"
      icon="info"
      action="Try again"
    ></ix-empty-state>
  </div>
  <div
    style="display: block; position: relative; height: 100%"
    id="main"
  ></div>
</div>

<style>
  .empty-state-container {
    position: absolute;
    justify-content: center;
    align-content: center;
    width: 100%;
    height: 100%;
    background-color: var(--theme-color-backdrop);
    z-index: 1;
  }
</style>
<script type="module">
  import { convertThemeName, registerTheme } from '@siemens/ix-echarts';
  import { themeSwitcher } from '@siemens/ix';

  function initChart(theme, options) {
    var myChart = echarts.init(
      document.querySelector('#main'),
      convertThemeName(theme)
    );
    myChart.setOption(options);

    return myChart;
  }

  function toggleOverlay() {
    const overlay = document.getElementById('empty-state-container');
    if (overlay.style.display === 'block') {
      overlay.style.display = 'none';
    } else {
      overlay.style.display = 'block';
    }
  }

  async function loadData(chart) {
    toggleOverlay();
    chart.showLoading({
      text: 'Loading...',
      textStyle: {
        fontSize: 30,
      },
    });
    await new Promise((resolve) => setTimeout(resolve, 2000));
    chart.hideLoading();
    toggleOverlay();
  }

  const data = {
    weekdays: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
    value: [],
  };

  const options = {
    xAxis: {
      type: 'category',
      data: data.weekdays,
    },
    yAxis: {
      type: 'value',
    },
    series: [
      {
        data: data.value,
        type: 'line',
      },
    ],
  };

  if (data.value.length === 0) {
    document.getElementById('empty-state-container').style.display =
      'block';
  } else {
    document.getElementById('empty-state-container').style.display = 'none';
  }

  registerTheme(echarts);

  var myChart = initChart(themeSwitcher.getCurrentTheme(), options);

  themeSwitcher.themeChanged.on((theme) => {
    myChart.dispose();
    myChart = initChart(theme, options);
  });

  (async function () {
    await window.customElements.whenDefined('ix-empty-state');
    const emptyState = document.querySelector('ix-empty-state');

    emptyState.addEventListener('actionClick', (event) =>
      loadData(myChart)
    );
  })();

  window.onresize = function () {
    myChart.resize();
  };
</script>
<!-- Preview code -->
<script type="module" src="./init.js"></script>
</body>
</html>
