<!--
SPDX-FileCopyrightText: 2024 Siemens AG

SPDX-License-Identifier: MIT

This source code is licensed under the MIT license found in the
LICENSE file in the root directory of this source tree.
-->

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ECharts example</title>
  <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.1/dist/echarts.min.js"></script>
</head>
<body class="">
<!-- Preview code -->
<div
  id="main"
  style="
        display: block;
        position: relative;
        width: 100%;
        height: 8rem;
        padding-top: 1rem;
      "
></div>

<script type="module">
  import { convertThemeName, registerTheme } from '@siemens/ix-echarts';
  import { themeSwitcher } from '@siemens/ix';

  function initChart(theme, options) {
    var myChart = echarts.init(
      document.querySelector('#main'),
      convertThemeName(theme)
    );
    myChart.setOption(options);

    return myChart;
  }

  function getComputedCSSColor(color) {
    return getComputedStyle(document.body).getPropertyValue(color);
  }

  var progressLineLength = 500;
  var maxValue = 100;
  var value = 70;

  const options = {
    graphic: {
      elements: [
        {
          type: 'group',
          left: 'center',
          top: 'center',
          children: [
            {
              type: 'rect',
              shape: {
                x:0,
                y:0,
                width: progressLineLength,
                height:10,
              },
              style: {
                fill: getComputedCSSColor('--theme-color-neutral'),
              },
            },
            {
              type: 'rect',
              shape: {
                x:0,
                y:0,
                width: progressLineLength*value/maxValue,
                height:10,
              },
              style: {
                fill: getComputedCSSColor('--theme-color-primary'),
              },
              keyframeAnimation: {
                duration: 1000,
                loop: false,
                keyframes: [
                  {
                    percent: 0,
                    scaleX: 0,
                  },
                  {
                    percent: 1,
                    scaleX: 1,
                  }
                ]
              }
            }
          ]
        }
      ]
    }
  };

  // providing echarts is in this case optional
  registerTheme(echarts);

  var myChart = initChart(themeSwitcher.getCurrentTheme(), options);

  themeSwitcher.themeChanged.on((theme) => {
    myChart.dispose();
    myChart = initChart(theme, options);
  });

  window.onresize = function () {
    myChart.resize();
  };
</script>
<!-- Preview code -->
<script type="module" src="./init.js"></script>s
</body>
</html>
